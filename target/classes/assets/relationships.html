<!DOCTYPE html>
<html>
	<head>
		<title>/relationships</title>
		<script src="jquery-3.3.1.min.js"></script>
		<script>
			
			$(document).ready(function(){
				
				
				$("#createForm").hide();
				$("#uploadForm").hide();
				$("#deleteConfirm").hide();
				
				var categoryJSON;
				
				$.getJSON("../categories",function(json){
						categoryJSON = json;
					}).done(function(){
						$.getJSON("../relationships",function(json){
							
							if(json.relationships==null){
								$("#relList").append("<h3>There are currently no category relationships in this microservice. You can add one</h3>");
							}else{
								for (var i=0; i< json.relationships.length; i++){
									var fromLabel;
									var toLabel;
									for(var j=0; j< categoryJSON.categories.length; j++){
										if(json.relationships[i].fromId==categoryJSON.categories[j].id){
											fromLabel = categoryJSON.categories[j].label;
										}
										if(json.relationships[i].toId==categoryJSON.categories[j].id){
											toLabel = categoryJSON.categories[j].label;
										}
									}
									var appendString = "<li><a href=\"relationship.html?id=";
									appendString = appendString +json.relationships[i].id+"\">/relationships/"+json.relationships[i].id;
									appendString = appendString +" from: "+json.relationships[i].fromId;
									appendString = appendString +" ("+fromLabel+")";
									appendString = appendString +" to: "+json.relationships[i].toId;
									appendString = appendString +" ("+toLabel+")";
									appendString = appendString +" - Type: "+json.relationships[i].type;
									appendString = appendString +"</a></li>";
									$("#relList").append(appendString);
								}
							}
							
						})
				});
				
				$("#read").click(function() {
					$("#createForm").hide("slow");
					$("#uploadForm").hide("slow");
					$("#deleteConfirm").hide("slow");
					$("#relList").empty();
					$("#relList").append("<h2>Available category relationships:</h2>");
					$.getJSON("../categories",function(json){
							categoryJSON = json;
						}).done(function(){
							$.getJSON("../relationships",function(json){
								
								if(json.relationships==null){
									$("#relList").append("<h3>There are currently no category relationships in this microservice. You can add one</h3>");
								}else{
									for (var i=0; i< json.relationships.length; i++){
										var fromLabel;
										var toLabel;
										for(var j=0; j< categoryJSON.categories.length; j++){
											if(json.relationships[i].fromId==categoryJSON.categories[j].id){
												fromLabel = categoryJSON.categories[j].label;
											}
											if(json.relationships[i].toId==categoryJSON.categories[j].id){
												toLabel = categoryJSON.categories[j].label;
											}
										}
										var appendString = "<li><a href=\"relationship.html?id=";
										appendString = appendString +json.relationships[i].id+"\">/relationships/"+json.relationships[i].id;
										appendString = appendString +" from: "+json.relationships[i].fromId;
										appendString = appendString +" ("+fromLabel+")";
										appendString = appendString +" to: "+json.relationships[i].toId;
										appendString = appendString +" ("+toLabel+")";
										appendString = appendString +" - Type: "+json.relationships[i].type;
										appendString = appendString +"</a></li>";
										$("#relList").append(appendString);
									}
								}
								
							})
					});
					$("#relList").show("fast");
				});
			
				$("#create").click(function() {
					$("#fromId").empty();
					$("#toId").empty();
					$.getJSON("../categories",function(json){
							
							var appendString = "";
							
							for(var j=0; j< json.categories.length; j++){
								
								appendString = appendString +"<option value=\""+json.categories[j].id+"\">";
								appendString = appendString +json.categories[j].id+" (";
								appendString = appendString +json.categories[j].label+")</option>";
								
								
							}
							$("#fromId").append(appendString);
							$("#toId").append(appendString);
									
						
					});
					$("#relList").hide("slow");
					$("#uploadForm").hide("slow");
					$("#deleteConfirm").hide("slow");
					$("#createForm").show("fast");
				});
				
				$("#upload").click(function() {
					$("#relList").hide("slow");
					$("#createForm").hide("slow");
					$("#deleteConfirm").hide("slow");
					$("#uploadForm").show("fast");
				});
				
				$("#delete").click(function() {
					$("#relList").hide("slow");
					$("#uploadForm").hide("slow");
					$("#createForm").hide("slow");
					$("#deleteConfirm").show("fast");
				});
				
				
				$("#createF").submit(function( event ) {
					event.preventDefault();
					console.log("Uploading data");
					
					
					var form = $("#createF").serializeArray();
					console.log(form);
					var json = "{ \"relationships\":[{\"id\":"+form[0].value;
					json = json + ", \"fromId\":"+form[1].value;
					json = json + ", \"toId\":"+form[2].value;
					json = json + ", \"type\": \""+form[3].value+"\"";
					json = json + "}]}";
					console.log(json);
					
					var url="../relationships";
					
					
					$.ajax({
    					url: url,
    					headers: {
    					    'Accept': 'application/json',
					        'Content-Type':'application/json'
					    },
					    method: 'POST',
					    dataType: 'json',
					    data: json,
					    success: function(data){
					    	console.log('something worked');
     					 	console.log('succes: '+data);
    					}
 					 });
					
				});
				
				$("#uploadF").submit(function( event ) {
					event.preventDefault();
					//console.log("Uploading data");
					var form = $("#uploadF").serializeArray();
					//console.log(form);
					var json = form[0].value;
					//console.log(json);
					
					var url="../relationships";
					
					
					$.ajax({
    					url: url,
    					headers: {
    					    'Accept': 'application/json',
					        'Content-Type':'application/json'
					    },
					    method: 'POST',
					    dataType: 'json',
					    data: json,
					    success: function(data){
					    	console.log('something worked');
     					 	console.log('succes: '+data);
    					}
 					 });
					
				});
				
				$("#deleteF").submit(function( event ) {
					event.preventDefault();
					//console.log("Deleting data");
					var form = $("#deleteF").serializeArray();
					//console.log(form);
					var json="";
					if(form[0].value=="delete"){
						var url="../relationships";
					
					
						$.ajax({
	    					url: url,
	    					headers: {
	    					    'Accept': 'application/json',
						        'Content-Type':'application/json'
						    },
						    method: 'DELETE',
						    dataType: 'json',
						    data: json,
						    success: function(data){
						    	console.log('something worked');
	     					 	console.log('succes: '+data);
	    					}
	 					 });
					}
					
					
					
				});
				
			
			});
			
		</script>
	</head>
<body>
	<h1>Manage relationships between categories:</h1>
	<button id="read">Read categories</button>
	<button id="create">Create relationships</button>
	<button id="upload">Upload relationship collection JSON</button>
	<button id="delete">Delete all relationships</button>
	<a href="index.html"><button>Back to overview</button></a>
	<div id="relList"><h2>Available category relationships:</h2></div>
	<div id="createForm">
		<h2>Create a relationship</h2>
			<form action="/" id="createF">
				<table>
					<tr><td>Id:</td><td><input type="text" name="id" placeholder="-1 if you don't know"></td></tr>
					<tr><td>From:</td><td><select name="fromId" id="fromId"></select></td></tr>
					<tr><td>To:</td><td><select name="toId" id="toId"></select></td></tr>
					<tr><td>Type:</td><td><select name="type">
						<option value="Sub">Sub</option>
						<option value="Equality">Equality</option>
					</select></td></tr>
					<tr><td></td><td><input type="submit" value="Upload Relationship"></form>
				</table>
	</div>
	<div id="uploadForm">
		<h2>Upload multiple categories using a JSON file</h2>
		<form action="/" id="uploadF">
			<textarea name="content" cols="70" rows="20">
{
	"relationships":[
		{"id": 0, "fromId": 0, "toId": 1, "type": "Sub"},
		{"id": 1, "fromId": 0, "toId": 2, "type": "Sub"}
	]
}
			</textarea><br>
			<input type="submit" value="Upload relationships">
		</form>	
	</div>
	<div id="deleteConfirm">
		<h2>Delete all relationships in this microservice</h2>
		<p>Note: To delete everything, type delete into the field and press the delete button.</p>
		<form action="/" id="deleteF">
			<input type="text" name="delete" placeholder="delete"><br>
			<input type="submit" value="Delete all categories">
		</form>	
	</div>
</body>
</html>